import{nativeVlElement,define,awaitUntil}from"/node_modules/vl-ui-core/dist/vl-core.min.js";import{VlLinkToolbarFactory}from"/node_modules/vl-ui-textarea/dist/vl-tinymce-link-toolbar.min.js";import{vlFormValidation,vlFormValidationElement}from"/node_modules/vl-ui-form-validation/dist/vl-form-validation-all.min.js";import"/node_modules/tinymce/tinymce.min.js";Promise.all([vlFormValidation.ready()]).then((()=>define("vl-textarea",VlTextarea,{extends:"textarea"})));export class VlTextarea extends(vlFormValidationElement(nativeVlElement(HTMLTextAreaElement))){static get _observedAttributes(){return vlFormValidation._observedAttributes().concat(["error","success"])}static get _observedClassAttributes(){return["disabled","block","error","success","focus","rich"]}connectedCallback(){this.classList.add("vl-textarea"),this._dressFormValidation(),this.isRich&&this._configureWysiwyg()}disconnectedCallback(){this.isRich&&this._destroyWysiwyg()}get isRich(){return this.hasAttribute("data-vl-rich")}get editor(){return this._editor}get _classPrefix(){return"vl-textarea--"}get _toolbar(){return this.getAttribute("toolbar")}get _wysiwygConfig(){return{target:this,menubar:!1,resize:!0,elementpath:!1,branding:!1,powerpaste_word_import:"clean",powerpaste_html_import:"clean",content_css:"/node_modules/vl-ui-textarea/dist/style.css",verify_html:!1,forced_root_block:"p",body_class:"vl-typography",plugins:"hr lists advlist paste",formats:{bold:{inline:"b"},italic:{inline:"i"},underline:{inline:"u"},strikethrough:{inline:"s"}},toolbar:this._toolbar||"undo redo | bold italic underline strikethrough",setup:t=>{this._registerVlLinkToolbar(t),this._initWysiwyg(t);new MutationObserver((()=>t.setContent(t.targetElm.value))).observe(this,{childList:!0,characterData:!0,subtree:!0})}}}_addBlockAttribute(){this.setAttribute("data-vl-block","")}_configureWysiwyg(){this.disabled=!0,this._addBlockAttribute(),tinyMCE.baseURL="/node_modules/tinymce";try{tinyMCE.init(this._wysiwygConfig)}catch(t){console.error(t)}}_initWysiwyg(t){this._editor=t,this.focus=()=>t.focus(),t.on("focus",(()=>{t.editorContainer.classList.add("focus"),t.getBody().classList.add("focus")})),t.on("blur",(()=>{t.editorContainer&&t.editorContainer.classList.remove("focus"),t.getBody&&t.getBody().classList.remove("focus"),t.save(),this.dispatchEvent(new Event("change"))}))}_destroyWysiwyg(){this._editor&&(this.disabled=!1,this._editor.destroy())}_registerVlLinkToolbar(t){t.ui.registry.addButton("vlLink",(new VlLinkToolbarFactory).create(t))}_errorChangedCallback(t,e){this.__toggleValidationClass(e,"error")}_successChangedCallback(t,e){this.__toggleValidationClass(e,"success")}_richChangedCallback(t,e){null!=e?this.isConnected&&this._configureWysiwyg():this._destroyWysiwyg()}__toggleValidationClass(t,e){this.isRich&&awaitUntil((()=>this._editor&&this._editor.getContainer())).then((()=>{this._editor.getContainer()&&(this._toggleClass(this._editor.getContainer(),t,e),this._toggleClass(this._editor.getBody(),t,e))}))}}